<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
	<meta name="viewport" content="width=320" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<title>data dashboard</title>
	<!--
	<script type="text/javascript" src="http://d3js.org/d3.v2.min.js"></script>
	<script src="//code.jquery.com/jquery-1.10.2.js"></script>
	-->
	<script type="text/javascript" src="lib/d3.min.js"></script>
	<script type="text/javascript" src="lib/jquery-1.11.1.min.js"></script>
	<script type="text/javascript" src="lib/jquery.color.js"></script>

	<link rel='stylesheet' href='css/riverEventStyle.css' type='text/css'/>

</head>
<body>

<div id="wrapper">

	<div id="elevation">
		<div class="elevation one"></div>
		<div class="elevation two"></div>
		<div class="elevation three"></div>
		<div class="elevation four"></div>
		<div class="elevation five"></div>
		<div class="elevation six"></div>
		<div class="elevation seven"></div>
		<div class="elevline a"></div>
		<div class="elevline c"></div>
		<div class="elevline e"></div>
		<div class="elevline g"></div>
		<div class="elevline i"></div>
		<div class="elevline k"></div>
		<div class="elevline m"></div>
		<div class="elevline n"></div>
		<div class="elevline o"></div>
		<div class="elevline b"></div>
		<div class="elevline d"></div>
		<div class="elevline f"></div>
		<div class="elevline h"></div>
		<div class="elevline j"></div>
		<div class="elevline l"></div>
		<div id="bar"></div>
	</div>

 	<div id="map">
		<div class="riverdot one"><p>Powdermill Nature Reserve</p></div>
		<div class="riverdot two"><p>Laughlintown</p></div>
		<div class="riverdot three"><p>Gorge</p></div>
		<div class="riverdot four"><p>Loyalhanna Dam</p></div>
		<div class="riverdot five"><p>Leechburg</p></div>
		<div id="pgh"><p>Pittsburgh</p></div>
		<div class="riverdot six"><p>Acmetonia</p></div>
		<div class="riverdot seven"><p>Montgomery Dam</p></div>

		<div id="oneTempGauge"></div>
		<div id="twoTempGauge"></div>
		<div id="threeTempGauge"></div>
		<div id="fourTempGauge"></div>
		<div id="fiveTempGauge"></div>
		<div id="sixTempGauge"></div>
		<div id="sevenTempGauge"></div>

		<div id="onePhGauge"></div>
		<div id="twoPhGauge"></div>
		<div id="threePhGauge"></div>
		<div id="fourPhGauge"></div>
		<div id="fivePhGauge"></div>
		<div id="sixPhGauge"></div>
		<div id="sevenPhGauge"></div>
			
		<div id="oneHeightGauge"></div>
		<div id="twoHeightGauge"></div>
		<div id="threeHeightGauge"></div>
		<div id="fourHeightGauge"></div>
		<div id="fourHeightGauge"></div>
		<div id="fiveHeightGauge"></div>
		<div id="sixHeightGauge"></div>
		<div id="sevenHeightGauge"></div>
	</div><!-- map -->

	<div class="controls">
		<div id="clock"></div>
		<div id="ph">PH</div>
		<div id="temp">Temperature</div>
		<div id="height">Gauge Height</div>
		<div id="rain">Let it rain</div>
		<div id="reset">Reset</div>
		<div id="raining">Reset</div>
	</div>
	
	<div id="dials">
		<div id="timeline"></div>
		<div id="time-label">Travel Time <br />in Minutes</div>
		<div id="time-one">0</div>
		<div id="time-two">17</div>
		<div id="time-three">21</div>
		<div id="time-four">34</div>
		<div id="time-five">46</div>
		<div id="time-six">57</div>
		<div id="time-seven">1:18</div>
		<div class="circleButton seven"></div>
		<div class="circleButton six"></div>
		<div class="circleButton five"></div>
		<div class="circleButton four"></div>
		<div class="circleButton three"></div>
		<div class="circleButton two"></div>
		<div class="circleButton one"></div>
		<div id="instructions">
			<h2>Touch a dot above to track a &#145;rain event&#146; from the Laurel Highlands to Pittsburgh!</h2>
			<h3>How does the clean rainwater affect the river - and how does the river affect the fresh water?</h3>
		</div>
	</div><!-- dials -->

</div><!-- wrapper -->

<script type="text/javascript" src="js/phGauge.js"></script>
<script type="text/javascript" src="js/temperatureGauge.js"></script>
<script type="text/javascript" src="js/heightGauge.js"></script>
<script type="text/javascript" src="js/elevationGraph.js"></script>
<script type="text/javascript" src="js/clock.js"></script>

<script>

var locations = ["one", "two", "three", "four", "five", "six", "seven"];
var values = [{ph:'7.5', temp:'65.48', height:'12.12', hour:'0', minute:'0', phAfter:'7.5', tempAfter:'0', heightAfter:'12.12'},
			  {ph:'7.5', temp:'66.27', height:'12.12', hour:'0', minute:'0', phAfter:'7.5', tempAfter:'0', heightAfter:'12.12'},
			  {ph:'7.5', temp:'71.26', height:'12.12', hour:'0', minute:'0', phAfter:'7.5', tempAfter:'0', heightAfter:'12.12'},
			  {ph:'7.5', temp:'76.15', height:'12.12', hour:'0', minute:'0', phAfter:'7.5', tempAfter:'0', heightAfter:'12.12'},
			  {ph:'7.5', temp:'75.15', height:'12.12', hour:'2', minute:'30', phAfter:'7.5', tempAfter:'74.91', heightAfter:'12.12'},
			  {ph:'7.5', temp:'67.41', height:'12.12', hour:'5', minute:'14', phAfter:'7.5', tempAfter:'75.56', heightAfter:'12.12'},
			  {ph:'7.5', temp:'75.74', height:'12.12', hour:'19', minute:'30', phAfter:'7.5', tempAfter:'0', heightAfter:'12.12'}];
var defaultTime = {hour:'12', minute:'0'};
var phGauges = [];
var temperatureGauges = [];
var heightGauges = [];
var clocks = [];
var resetOn = false;
var status = 2;

function onDocumentReady() {

	hideGauges("PhGauge");
	hideGauges("HeightGauge");
	hideTimes();

	/* ---------------------------------------------------------- ELEVATION GRAPH ---- */

	function createDailyGraph(cssID, min, xmax, ymax) {

		var newData = [];
		var graphs = [];
		var file = "riverData/rainEventData/elevationData.csv";


			d3.csv(file, function(error, data) {

				data.forEach(function(d) {
					newData.push({date:d.Distance, value:d.Elevation});
	            });
	           
	            var config = {
		        	min: min,
		        	xmax: xmax,
					ymax: ymax,
					data: newData
				}

				graphs[cssID] = new DailyGraph(cssID, config);
				graphs[cssID].render();
			});
	}

	createDailyGraph("elevation", 600, 728152, 2200); // DV or Gen
	

	/* ---------------------------------------------------------- GAUGES ---- */

	function createPhGauge(cssID, label) {
		var config = {
			size: 115,
			label: label,
			min: 0,
			max: 14,
			minorTicks: 1,
			majorTicks: 15,
			labelX: 0,
			labelY: 23
		}
						
		phGauges[cssID] = new PhGauge(cssID + "PhGauge", config);
		phGauges[cssID].render();
	}

	function createTemperatureGauge(cssID){
		var config = {
			size: 110,
			min: 30,
			max: 90,
			minorTicks: 10,
			majorTicks: 7,
			transitionMs: 3000,
			labelMarginX: -6
		}
						
		temperatureGauges[cssID] = new TemperatureGauge(cssID + "TempGauge", config);
		temperatureGauges[cssID].render();
	}

	function createHeightGauge(cssID, label, fl) {
		var config = {
			size: 148,
			label: label,
			max: 34,
			cx: 125,
			cy: 170, 
			floodLevel: fl
		}
						
		heightGauges[cssID] = new HeightGauge(cssID + "HeightGauge", config);
		heightGauges[cssID].render();
	}

	for (var i = 0; i < locations.length; i++){
		createHeightGauge(locations[i], locations[i], 0);
		createTemperatureGauge(locations[i]);
		createPhGauge(locations[i]);
		updateRiverGauges(i);
	}

	// update the data for all gauges and labels
	function updateRiverGauges(location){
		updatePh(location);
		updateTemp(location);
		updateHeight(location);
	}

	function updatePh(l){
		phGauges[locations[l]].reset(1);
		phGauges[locations[l]].redraw(values[l].ph);
	}

	function updateTemp(l){		
		temperatureGauges[locations[l]].redraw(values[l].temp);
	}

	function updateHeight(l){
		heightGauges[locations[l]].reset(1);
		heightGauges[locations[l]].redraw(values[l].height);
	}

	// capitalizes the first Letter of the string
	function capFirstLetter(string){

		return string.charAt(0).toUpperCase() + string.slice(1);
	}

	// extract date to display
	function formatDateToDisplay(string){
		var date = string.substr(0, 10);

		var year = date.substr(0, 4);
		var month = date.substr(5,2);
		var day = date.substr(8, 5);

		date = month+"/"+day+"/"+year;

		return date;
	}

	// extract time to display
	function formatTimeToDisplay(string){
		
		var time = string.substr(11,5);
		var hour = time.substr(0,2);
		var minutes = time.substr(3,4);
		
		if(parseInt(hour) > 12){
			hour = hour - 12;
			time = hour+":"+minutes+" pm";
		} else {
			time = time + "am";
		}
		return time;
	}

	// convert C to F
	function convertCtoF(c){
		// (°C × 9/5) + 32
		var f = c * 1.8 + 32;
		f = Math.round(f*100)/100;
		return f;
	}

	/* ---------------------------------------------------------- CONTROL PANEL ---- */
	function createClocks(cssID, h, m) {
		var config = {
			width: 200,
			hour:h,
			minute:m
		}
						
		clocks[cssID] = new Clock(cssID, config);
	}

	createClocks("clock", 12, 0);

	
	$('#ph').click(function() {
		hideGauges("TempGauge");
		showGauges("PhGauge");
		hideGauges("HeightGauge");
	});
	$('#temp').click(function() {
		showGauges("TempGauge");
		hideGauges("PhGauge");
		hideGauges("HeightGauge");
	});
	$('#height').click(function() {
		hideGauges("TempGauge");
		hideGauges("PhGauge");
		showGauges("HeightGauge");
	});

	$('.one').click(function() {
		highlight("one", "#ecc82e", 0, "50px");
	});
	$('.two').click(function() {
		highlight("two", "#ecc82e", 1, "150px");
	});
	$('.three').click(function() {
		highlight("three", "#ecc82e", 2, "175px");
	});
	$('.four').click(function() {
		highlight("four", "#ecc82e", 3, "210px");
	});
	$('.five').click(function() {
		highlight("five", "#ecc82e", 4, "220px");
	});
	$('.six').click(function() {
		highlight("six", "#ecc82e", 5, "225px");
	});
	$('.seven').click(function() {
		highlight("seven", "#ecc82e", 6, "230px");
	});

	$('#reset').toggle();
	$('#raining').toggle();

	$('#reset').click(function() {

		$('#reset').toggle();
		$('#rain').toggle();

		fadeOutTimes();

		resetEventTrigger('none');
		$("#bar").animate({top: "40px"}, 1000);

		clocks["clock"].redraw(values[0].hour, values[0].minute);

		//reset gauges
		for (var i = 0; i < locations.length; i++){
			temperatureGauges[locations[i]].redraw(values[i].temp);
			heightGauges[locations[i]].reset(1);
			heightGauges[locations[i]].redraw(values[i].height);
			phGauges[locations[i]].reset(1);
			phGauges[locations[i]].redraw(values[i].ph);
		};

		resetOn = false;
	});

	$('#rain').click(function() {

		resetOn = true;
		$('#raining').toggle();
		$('#rain').toggle();

		highlight("one", "#ecc82e", 0, "50px");
		setTimeout( function(){ highlight("two", "#ecc82e", 1, "150px"); }, 1000 );
		setTimeout( function(){ highlight("three", "#ecc82e", 2, "175px"); }, 2000 );
		setTimeout( function(){ highlight("four", "#ecc82e", 3, "210px"); }, 3000 );
		setTimeout( function(){ highlight("five", "#ecc82e", 4, "220px"); }, 4000 );
		setTimeout( function(){ highlight("six", "#ecc82e", 5, "225px"); }, 5000 );
		setTimeout( function(){ highlight("seven", "#ecc82e", 6, "230px"); }, 6000 );

		setTimeout( function(){
			resetEventTrigger('none');
			$('#reset').toggle();
			$('#raining').toggle();
		}, 7000 );
	});

	function resetEventTrigger(id){ 
		if(id != 'one') $('.one').css('background', '#4799c6');
		if(id != 'two')$('.two').css('background', '#4799c6');
		if(id != 'three')$('.three').css('background', '#4799c6');
		if(id != 'four')$('.four').css('background', '#4799c6');
		if(id != 'five')$('.five').css('background', '#4799c6');
		if(id != 'six')$('.six').css('background', '#4799c6');
		if(id != 'seven')$('.seven').css('background', '#4799c6');
	}

	function showGauges(gauge){
		$("#one"+gauge).fadeIn();
		$("#three"+gauge).fadeIn();
		$("#four"+gauge).fadeIn();
		$("#five"+gauge).fadeIn();
		$("#six"+gauge).fadeIn();
		$("#seven"+gauge).fadeIn();
		$("#two"+gauge).fadeIn();
	}

	function hideGauges(gauge){
		$("#one"+gauge).fadeOut();
		$("#three"+gauge).fadeOut();
		$("#four"+gauge).fadeOut();
		$("#five"+gauge).fadeOut();
		$("#six"+gauge).fadeOut();
		$("#seven"+gauge).fadeOut();
		$("#two"+gauge).fadeOut();
	}

	function hideTimes(){
		$("#time-label").hide();
		$("#time-one").hide();
		$("#time-two").hide();
		$("#time-three").hide();
		$("#time-four").hide();
		$("#time-five").hide();
		$("#time-six").hide();
		$("#time-seven").hide();
	}

	function fadeOutTimes(){
		$("#time-label").fadeOut();
		$("#time-one").fadeOut();
		$("#time-two").fadeOut();
		$("#time-three").fadeOut();
		$("#time-four").fadeOut();
		$("#time-five").fadeOut();
		$("#time-six").fadeOut();
		$("#time-seven").fadeOut();
	}

	function highlight(name, color, order, sliderNumber){
		//$('.'+name).css('background', color);
		
		jQuery("."+name).animate({
            backgroundColor: color
    	}, 500 );

		resetEventTrigger(name);

		temperatureGauges[locations[order]].redraw(values[order].tempAfter);
		heightGauges[locations[order]].reset(1);
		heightGauges[locations[order]].redraw(values[order].heightAfter);
		phGauges[locations[order]].reset(1);
		phGauges[locations[order]].redraw(values[order].phAfter);
		clocks["clock"].redraw(values[order].hour, values[order].minute);

		$("#bar").animate({top: sliderNumber}, 1000);
		$("#time-"+name).fadeIn();
										
		if(!resetOn){
			$('#reset').toggle();
			$('#rain').toggle();
			$("#time-label").fadeIn();
		}
		resetOn = true;
	}
}

if ( !window.isLoaded ) {
	window.addEventListener("load", function() {
		onDocumentReady();
	}, false);
} else {
	onDocumentReady();
}

</script>

</body>
</html>